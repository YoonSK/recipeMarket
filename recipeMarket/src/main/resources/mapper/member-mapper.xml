<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">

	<resultMap type="Member" id="memberRS">
		<id property = "memberNo" column="MEMBER_NO"/>
		<result property = "id" column="ID"/>	
		<result property = "pwd" column ="PWD"/>
		<result property = "name" column ="NAME"/>
		<result property = "nickName" column ="NICKNAME"/>		
		<result property = "email" column ="EMAIL"/>
		<result property = "birth" column ="BIRTH"/>		
		<result property = "phone" column ="PHONE"/>
		<result property = "zip" column ="ZIP"/>		
		<result property = "address" column ="ADDRESS"/>
		<result property = "address2" column ="ADDRESS2"/>		
		<result property = "grade" column ="GRADE"/>
		<result property = "deleted" column ="DELETED"/>
	</resultMap> 	
	
  	<select id="memberLogin" parameterType="Member" resultMap="memberRS">
		select * 
		from member
		where id = #{id}
			  and deleted = 'N'			  
	</select>
 	<insert id="memberJoin" parameterType="Member">
		insert into member
		values(seq_mno.nextval, #{id}, #{pwd}, #{name}, #{nickName}, #{email}, #{phone}, #{birth}, 
				#{zip}, #{address}, #{address2}, 1, default)
	</insert> 


	<select id="checkIdDup" parameterType="string" resultType="_int">
		select count(*)
		from member
		where id=#{id}
	</select>
	
	<select id="checkNickDup" parameterType="string" resultType="_int">
		select count(*)
		from member
		where nickName=#{nickName}
	</select>
	
	<resultMap type="Photo" id="photoRS">
		<id property = "photoNo" column="PHOTO_NO"/>
		<result property = "boardNo" column="BOARD_NO"/>	
		<result property = "targetNo" column ="TARGET_NO"/>
		<result property = "fileLevel" column ="FILE_LEVEL"/>
		<result property = "originName" column ="ORIGIN_NAME"/>		
		<result property = "changeName" column ="CHANGE_NAME"/>	
		<result property = "deleted" column ="DELETED"/>
	</resultMap>  
 	
	<insert id="uploadImage" parameterType="Photo">
		insert into photo
		values(seq_phn.nextval, 0, seq_mno.currval, 0, #{originName}, #{changeName}, default)
	</insert>
 
   	<select id="getPhoto" parameterType="Photo" resultType="string">
		select change_name
		from photo
		where target_no = #{memberNo}
			  and deleted = 'N'			  
	</select>
	
	<update id="mDelete" parameterType="Member">
		update member
		set deleted='Y'
		where member_no = ${no}
	</update>	

	<update id="mUpdate" parameterType="Member">
		update member
		set name=#{name}, nickName=#{nickName}, email=#{email}, phone=#{phone},
			zip=#{zip}, address=#{address}, address2=#{address2}
		where member_no=#{memberNo}
	</update>

	<update id="updateImage" parameterType="Photo">
		update photo
		set origin_name = #{originName}, change_name = #{changeName}
		where target_no=#{targetNo}
	</update>
	
	<update id="pwdUpdate" parameterType="Member">
		update member
		set pwd=#{pwd}
		where member_no=#{memberNo}
	</update>
	
	<select id="findId" parameterType="Member" resultType="string">
		select id from member where name=#{name} and email=#{email}
	</select>
	
	<update id="updatePwd" parameterType="Member">
		update member set pwd=#{pwd} where id=#{id}
	</update>
</mapper>
